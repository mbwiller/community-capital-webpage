<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Capital - Split Bills & Invest Together</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.3/cdn.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js"></script>
    <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/5.0.4/tesseract.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * { font-family: 'Inter', sans-serif; }
        
        @keyframes fadeInUp {
            0% { opacity: 0; transform: translateY(30px); filter: blur(10px); }
            100% { opacity: 1; transform: translateY(0); filter: blur(0px); }
        }
        @keyframes slideInLeft {
            0% { opacity: 0; transform: translateX(-30px); filter: blur(5px); }
            100% { opacity: 1; transform: translateX(0); filter: blur(0px); }
        }
        @keyframes slideInRight {
            0% { opacity: 0; transform: translateX(30px); filter: blur(5px); }
            100% { opacity: 1; transform: translateX(0); filter: blur(0px); }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.2; }
        }
        
        .animate-fade-in-up { animation: fadeInUp 0.8s ease-out forwards; }
        .animate-slide-in-left { animation: slideInLeft 0.8s ease-out forwards; }
        .animate-slide-in-right { animation: slideInRight 0.8s ease-out forwards; }
        .animate-float { animation: float 6s ease-in-out infinite; }
        .animate-pulse-slow { animation: pulse 3s ease-in-out infinite; }
        
        .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .gradient-border {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(99, 102, 241, 0.3));
            padding: 1px;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body x-data="communityCapitalApp()" x-init="init()" class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 text-slate-900 overflow-x-hidden">
    
    <!-- Background Elements -->
    <div class="fixed inset-0 z-0">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl animate-pulse-slow"></div>
        <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-indigo-500/10 rounded-full blur-3xl animate-pulse-slow" style="animation-delay: 1s"></div>
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(59,130,246,0.05),transparent_50%)]"></div>
    </div>

    <!-- Navigation -->
    <header class="relative z-50 border-b border-slate-200/60 glass sticky top-0">
        <div class="max-w-7xl mx-auto px-6 lg:px-8">
            <nav class="flex items-center justify-between h-16">
                <a @click="currentView = 'home'" href="#" class="flex items-center gap-3 text-lg font-semibold group animate-slide-in-left">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg shadow-blue-500/25">
                        <svg class="h-5 w-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                    </div>
                    <span class="text-slate-900 font-bold">Community Capital</span>
                </a>

                <div class="hidden lg:flex items-center gap-8 animate-fade-in-up">
                    <div class="flex items-center gap-6 text-sm font-medium">
                        <button @click="currentView = 'split'" class="px-4 py-2 hover:bg-blue-100 hover:text-blue-700 rounded-2xl transition-all duration-300" :class="currentView === 'split' ? 'bg-blue-100 text-blue-700' : 'text-slate-600'">Split & Pay</button>
                        <button @click="currentView = 'groups'" class="px-4 py-2 hover:bg-blue-100 hover:text-blue-700 rounded-2xl transition-all duration-300" :class="currentView === 'groups' ? 'bg-blue-100 text-blue-700' : 'text-slate-600'">My Groups</button>
                        <button @click="currentView = 'invest'" class="px-4 py-2 hover:bg-blue-100 hover:text-blue-700 rounded-2xl transition-all duration-300" :class="currentView === 'invest' ? 'bg-blue-100 text-blue-700' : 'text-slate-600'">Invest</button>
                        <button @click="currentView = 'dashboard'" class="px-4 py-2 hover:bg-blue-100 hover:text-blue-700 rounded-2xl transition-all duration-300" :class="currentView === 'dashboard' ? 'bg-blue-100 text-blue-700' : 'text-slate-600'">Dashboard</button>
                    </div>
                    
                    <div class="flex items-center gap-4">
                        <div class="w-px h-6 bg-slate-300"></div>
                        <template x-if="!user">
                            <div class="flex gap-4">
                                <button @click="showLogin = true" class="text-sm font-medium text-slate-600 hover:text-slate-900 transition-colors duration-300">Sign In</button>
                                <button @click="showSignup = true" class="text-sm font-medium text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 rounded-2xl px-6 py-2.5 shadow-lg shadow-blue-500/25">Get Started</button>
                            </div>
                        </template>
                        <template x-if="user">
                            <div class="flex items-center gap-4">
                                <span class="text-sm text-slate-600">Welcome, <span x-text="user.name" class="font-semibold"></span></span>
                                <button @click="logout()" class="text-sm font-medium text-slate-600 hover:text-slate-900 transition-colors duration-300">Sign Out</button>
                            </div>
                        </template>
                    </div>
                </div>

                <button @click="mobileMenu = !mobileMenu" class="lg:hidden p-2 hover:bg-slate-100 rounded-2xl transition-colors duration-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </nav>
        </div>
    </header>

    <div class="relative z-10">
        <!-- Home View -->
        <section x-show="currentView === 'home'" class="max-w-7xl mx-auto px-6 lg:px-8 py-20">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-16">
                <!-- Hero Content -->
                <div class="lg:col-span-6 animate-slide-in-left">
                    <div class="gradient-border rounded-3xl mb-8 inline-block">
                        <div class="bg-white rounded-3xl px-4 py-2">
                            <div class="flex items-center gap-2 text-sm font-medium">
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-slate-700">Social Finance Platform</span>
                            </div>
                        </div>
                    </div>

                    <h1 class="sm:text-6xl xl:text-7xl leading-none text-5xl font-bold tracking-tight mb-8">
                        <span class="block text-slate-900">Split bills.</span>
                        <span class="block text-slate-900">Invest</span>
                        <span class="block gradient-text">together.</span>
                    </h1>

                    <p class="text-xl text-slate-600 mb-10 max-w-lg leading-relaxed">
                        Automatically split expenses at purchase time, then invest your savings as a group. Build wealth collaboratively with friends, family, and communities.
                    </p>

                    <div class="flex flex-col sm:flex-row gap-4 mb-16">
                        <button @click="user ? currentView = 'groups' : showSignup = true" class="px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold rounded-3xl transition-all duration-300 shadow-xl shadow-blue-500/25 transform hover:scale-105">
                            Start a Group
                        </button>
                        <button @click="showDemo = true" class="px-8 py-4 border border-slate-300 hover:border-slate-400 text-slate-700 font-semibold rounded-3xl transition-all duration-300 backdrop-blur-sm bg-white/60">
                            Watch Demo
                        </button>
                    </div>

                    <!-- Stats Grid -->
                    <div class="grid grid-cols-3 gap-8">
                        <div class="text-center lg:text-left">
                            <div class="text-3xl font-bold text-slate-900 mb-1">$<span x-text="(totalSplit/1000000).toFixed(1)"></span>M+</div>
                            <div class="text-sm text-slate-500">Split & Invested</div>
                        </div>
                        <div class="text-center lg:text-left">
                            <div class="text-3xl font-bold text-slate-900 mb-1"><span x-text="activeGroups"></span>K+</div>
                            <div class="text-sm text-slate-500">Active Groups</div>
                        </div>
                        <div class="text-center lg:text-left">
                            <div class="text-3xl font-bold text-slate-900 mb-1">58%</div>
                            <div class="text-sm text-slate-500">Avg. Savings Rate</div>
                        </div>
                    </div>
                </div>

                <!-- Interactive Cards -->
                <div class="lg:col-span-6 space-y-6 animate-fade-in-up">
                    <div class="rounded-3xl p-6 backdrop-blur-xl border border-white/40 bg-white/70">
                        <h3 class="text-lg font-semibold text-slate-900 mb-4">Bank Connection</h3>
                        <div class="flex gap-3">
                            <button class="px-4 py-2 bg-slate-900 text-white rounded-xl" @click="initPlaid()">Connect with Plaid</button>
                            <span class="text-sm text-slate-600" x-show="plaidStatus" x-text="plaidStatus"></span>
                        </div>
                    </div>
                    <!-- Live Group Activity Card -->
                    <div class="rounded-3xl p-6 backdrop-blur-xl border border-white/40 shadow-xl animate-float bg-white/70">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-lg font-semibold text-slate-900 mb-1">Live Activity</h3>
                                <p class="text-sm text-slate-500">Real-time group transactions</p>
                            </div>
                            <div class="flex gap-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-xs text-slate-500">Live</span>
                            </div>
                        </div>

                        <div class="space-y-3">
                            <template x-for="activity in liveActivities.slice(0, 3)" :key="activity.id">
                                <div class="flex items-center gap-3 p-3 bg-slate-50 border border-slate-200 rounded-2xl">
                                    <div class="w-10 h-10 rounded-xl flex items-center justify-center" :class="activity.color">
                                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-medium text-slate-900" x-text="activity.merchant"></p>
                                        <p class="text-sm text-slate-500">
                                            <span x-text="activity.group"></span> â€¢ <span x-text="activity.members"></span> members
                                        </p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-semibold text-slate-900">$<span x-text="activity.amount.toFixed(2)"></span></p>
                                        <p class="text-xs text-slate-500" x-text="activity.time"></p>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <button @click="currentView = 'split'" class="mt-4 w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-xl transition-all duration-300">
                            Start Splitting Now
                        </button>
                    </div>

                    <!-- AI Features Preview -->
                    <div class="rounded-3xl p-6 backdrop-blur-xl border border-white/40 bg-white/70 shadow-xl">
                        <h3 class="text-lg font-semibold text-slate-900 mb-4">AI-Powered Features</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="p-3 hover:bg-slate-50 rounded-xl transition-colors duration-300 cursor-pointer">
                                <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mb-2">
                                    <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                </div>
                                <p class="text-sm font-medium text-slate-900">Smart Receipt Scan</p>
                                <p class="text-xs text-slate-500">Instant OCR parsing</p>
                            </div>
                            
                            <div class="p-3 hover:bg-slate-50 rounded-xl transition-colors duration-300 cursor-pointer">
                                <div class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mb-2">
                                    <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                                    </svg>
                                </div>
                                <p class="text-sm font-medium text-slate-900">Smart Insights</p>
                                <p class="text-xs text-slate-500">Personalized tips</p>
                            </div>
                            
                            <div class="p-3 hover:bg-slate-50 rounded-xl transition-colors duration-300 cursor-pointer">
                                <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mb-2">
                                    <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                    </svg>
                                </div>
                                <p class="text-sm font-medium text-slate-900">Investment AI</p>
                                <p class="text-xs text-slate-500">Portfolio optimization</p>
                            </div>
                            
                            <div class="p-3 hover:bg-slate-50 rounded-xl transition-colors duration-300 cursor-pointer">
                                <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mb-2">
                                    <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                                <p class="text-sm font-medium text-slate-900">Auto-Schedule</p>
                                <p class="text-xs text-slate-500">Recurring splits</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feature Cards Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 animate-fade-in-up">
                <div class="rounded-3xl p-8 backdrop-blur-xl border border-white/40 hover:border-white/60 transition-all duration-500 transform hover:scale-[1.02] group bg-white/60">
                    <div class="w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-3xl flex items-center justify-center mb-8 group-hover:scale-110 transition-transform duration-300">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-semibold text-slate-900 mb-4 tracking-tight">Instant Bill Splitting</h3>
                    <p class="text-slate-600 leading-relaxed mb-8">Pay with one card, charge everyone instantly. No more IOUs, no more awkward reminders. Just seamless shared expenses.</p>
                    <button @click="currentView = 'split'" class="flex items-center gap-2 text-slate-700 font-medium hover:text-blue-600 transition-colors duration-300 cursor-pointer">
                        Learn more
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>

                <div class="rounded-3xl p-8 backdrop-blur-xl border border-white/40 hover:border-white/60 transition-all duration-500 transform hover:scale-[1.02] group bg-white/60">
                    <div class="w-14 h-14 bg-gradient-to-br from-green-500 to-emerald-600 rounded-3xl flex items-center justify-center mb-8 group-hover:scale-110 transition-transform duration-300">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-semibold text-slate-900 mb-4 tracking-tight">Group Investing</h3>
                    <p class="text-slate-600 leading-relaxed mb-8">Pool money with friends and family to invest together. Make decisions democratically and build wealth as a community.</p>
                    <button @click="currentView = 'invest'" class="flex items-center gap-2 text-slate-700 font-medium hover:text-green-600 transition-colors duration-300 cursor-pointer">
                        Learn more
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>

                <div class="rounded-3xl p-8 backdrop-blur-xl border border-white/40 hover:border-white/60 transition-all duration-500 transform hover:scale-[1.02] group bg-white/60">
                    <div class="w-14 h-14 bg-gradient-to-br from-purple-500 to-pink-600 rounded-3xl flex items-center justify-center mb-8 group-hover:scale-110 transition-transform duration-300">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-semibold text-slate-900 mb-4 tracking-tight">AI Financial Assistant</h3>
                    <p class="text-slate-600 leading-relaxed mb-8">Smart receipt scanning, personalized investment insights, and automated expense categorization powered by AI.</p>
                    <button @click="showAIDemo = true" class="flex items-center gap-2 text-slate-700 font-medium hover:text-purple-600 transition-colors duration-300 cursor-pointer">
                        Learn more
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- Split & Pay View -->
        <section x-show="currentView === 'split'" class="max-w-7xl mx-auto px-6 lg:px-8 py-12">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">Split a Bill</h2>
                <p class="text-xl text-slate-600">Upload a receipt or enter items manually to split expenses with your group</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Receipt Upload Section -->
                <div class="rounded-3xl p-8 backdrop-blur-xl border border-white/40 bg-white/70">
                    <h3 class="text-xl font-semibold text-slate-900 mb-6">Upload Receipt</h3>
                    
                    <div class="mb-6">
                        <label for="receipt-upload" class="block w-full">
                            <div class="border-2 border-dashed border-slate-300 rounded-2xl p-8 text-center hover:border-blue-500 transition-colors duration-300 cursor-pointer">
                                <svg class="w-12 h-12 text-slate-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                                <p class="text-slate-600 mb-2">Drop receipt image here or click to browse</p>
                                <p class="text-sm text-slate-500">Supports JPG, PNG, PDF (Max 10MB)</p>
                            </div>
                        </label>
                        <input type="file" id="receipt-upload" class="hidden" accept="image/*,.pdf" @change="handleReceiptUpload($event)">
                    </div>

                    <template x-if="scanningReceipt">
                        <div class="text-center py-8">
                            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>
                            <p class="text-slate-600">Scanning receipt with AI...</p>
                        </div>
                    </template>

                    <template x-if="scannedItems.length > 0">
                        <div>
                            <h4 class="font-semibold text-slate-900 mb-4">Scanned Items</h4>
                            <div class="space-y-2 max-h-64 overflow-y-auto">
                                <template x-for="(item, index) in scannedItems" :key="index">
                                    <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                                        <input type="text" x-model="item.name" class="flex-1 bg-transparent border-none outline-none text-slate-900">
                                        <input type="number" x-model="item.price" step="0.01" class="w-24 text-right bg-transparent border-none outline-none text-slate-900 font-semibold">
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>

                    <div class="mt-6">
                        <h4 class="font-semibold text-slate-900 mb-4">Or Add Items Manually</h4>
                        <div class="space-y-3">
                            <div class="flex gap-3">
                                <input type="text" x-model="newItem.name" placeholder="Item name" class="flex-1 px-4 py-3 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <input type="number" x-model="newItem.price" placeholder="Price" step="0.01" class="w-32 px-4 py-3 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <button @click="addItem()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-colors duration-300">Add</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Split Configuration Section -->
                <div class="rounded-3xl p-8 backdrop-blur-xl border border-white/40 bg-white/70">
                    <h3 class="text-xl font-semibold text-slate-900 mb-6">Configure Split</h3>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-700 mb-2">Select Group</label>
                        <select x-model="selectedGroup" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Create new group...</option>
                            <template x-for="group in userGroups" :key="group.id">
                                <option :value="group.id" x-text="group.name"></option>
                            </template>
                        </select>
                    </div>

                    <template x-if="!selectedGroup">
                        <div class="space-y-4">
                            <input type="text" x-model="newGroupName" placeholder="Group name" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Add Members</label>
                                <div class="flex gap-3 mb-3">
                                    <input type="email" x-model="newMemberEmail" placeholder="Email address" class="flex-1 px-4 py-3 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <button @click="addMember()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-colors duration-300">Add</button>
                                </div>
                                <div class="space-y-2">
                                    <template x-for="(member, index) in newGroupMembers" :key="index">
                                        <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
                                            <span x-text="member" class="text-slate-900"></span>
                                            <button @click="newGroupMembers.splice(index, 1)" class="text-red-500 hover:text-red-700">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>

                    <template x-if="selectedGroup">
                        <div>
                            <h4 class="font-semibold text-slate-900 mb-4">Assign Items</h4>
                            <div class="space-y-3 max-h-64 overflow-y-auto">
                                <template x-for="(item, index) in [...scannedItems, ...manualItems]" :key="index">
                                    <div class="p-4 bg-slate-50 rounded-xl">
                                        <div class="flex items-center justify-between mb-3">
                                            <span x-text="item.name" class="font-medium text-slate-900"></span>
                                            <span class="font-semibold text-slate-900">$<span x-text="item.price.toFixed(2)"></span></span>
                                        </div>
                                        <div class="flex gap-2 flex-wrap">
                                            <template x-for="member in getGroupMembers(selectedGroup)" :key="member.id">
                                                <button 
                                                    @click="toggleItemAssignment(index, member.id)"
                                                    class="px-3 py-1 text-sm rounded-full transition-colors duration-300"
                                                    :class="isAssigned(index, member.id) ? 'bg-blue-600 text-white' : 'bg-white border border-slate-300 text-slate-700 hover:border-blue-500'"
                                                    x-text="member.name">
                                                </button>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>

                    <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-2xl">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-slate-600">Subtotal</span>
                            <span class="text-sm font-semibold text-slate-900">$<span x-text="calculateSubtotal().toFixed(2)"></span></span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-slate-600">Tax (%)</span>
                            <div class="flex items-center gap-3">
                                <input type="number" step="0.1" min="0" max="50" x-model.number="taxRatePct" @input="taxRate = (taxRatePct||8.5)/100" class="w-24 px-3 py-1.5 bg-white border border-slate-300 rounded-xl">
                                <span class="text-sm font-semibold text-slate-900">$<span x-text="(calculateSubtotal() * (taxRate||0.085)).toFixed(2)"></span></span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-slate-600">Tip (%)</span>
                            <div class="flex items-center gap-3">
                                <input type="number" step="0.1" min="0" max="100" x-model.number="tipRatePct" @input="tipRate = (tipRatePct||18)/100" class="w-24 px-3 py-1.5 bg-white border border-slate-300 rounded-xl">
                                <span class="text-sm font-semibold text-slate-900">$<span x-text="(calculateSubtotal() * (tipRate||0.18)).toFixed(2)"></span></span>
                            </div>
                        </div>
                        <div class="w-full h-px bg-blue-200 my-3"></div>
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-slate-900">Total</span>
                            <span class="text-xl font-bold text-slate-900">$<span x-text="calculateTotal().toFixed(2)"></span></span>
                        </div>
                    </div>

                    <button @click="processSplit()" class="mt-6 w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold rounded-2xl transition-all duration-300 shadow-xl shadow-blue-500/25">
                        Generate Virtual Card & Split
                    </button>
                </div>
            </div>
        </section>

        <!-- Groups View -->
        <section x-show="currentView === 'groups'" class="max-w-7xl mx-auto px-6 lg:px-8 py-12">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">My Groups</h2>
                <p class="text-xl text-slate-600">Manage your groups and track shared expenses</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <template x-for="group in userGroups" :key="group.id">
                    <div class="rounded-3xl p-6 backdrop-blur-xl border border-white/40 bg-white/70 hover:shadow-xl transition-all duration-300">
                        <div class="flex items-center justify-between mb-6">
                            <div class="w-12 h-12 rounded-2xl flex items-center justify-center text-white font-bold" :style="'background: ' + group.color">
                                <span x-text="group.name.substring(0, 2).toUpperCase()"></span>
                            </div>
                            <div class="flex gap-2">
                                <span class="text-sm text-slate-500"><span x-text="group.members.length"></span> members</span>
                            </div>
                        </div>
                        
                        <h3 class="text-xl font-semibold text-slate-900 mb-2" x-text="group.name"></h3>
                        
                        <div class="mb-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm text-slate-600">Total Split</span>
                                <span class="font-semibold text-slate-900">$<span x-text="group.totalSplit.toFixed(2)"></span></span>
                            </div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm text-slate-600">Your Share</span>
                                <span class="font-semibold text-slate-900">$<span x-text="group.yourShare.toFixed(2)"></span></span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-slate-600">Invested</span>
                                <span class="font-semibold text-green-600">$<span x-text="group.invested.toFixed(2)"></span></span>
                            </div>
                        </div>
                        
                        <div class="pt-4 border-t border-slate-200">
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-sm font-medium text-slate-700">Recent Activity</span>
                                <span class="text-xs text-slate-500">Last 24h</span>
                            </div>
                            <div class="space-y-2">
                                <template x-for="activity in group.recentActivities.slice(0, 2)" :key="activity.id">
                                    <div class="flex items-center justify-between text-sm">
                                        <span x-text="activity.merchant" class="text-slate-700"></span>
                                        <span class="font-medium text-slate-900">$<span x-text="activity.amount.toFixed(2)"></span></span>
                                    </div>
                                </template>
                            </div>
                        </div>
                        
                        <div class="mt-4 grid grid-cols-2 gap-3">
                            <button @click="viewGroupDetails(group.id)" class="py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-xl transition-all duration-300">
                                View Details
                            </button>
                            <button @click="inviteToGroup(group.id)" class="py-2 px-4 border border-slate-300 hover:border-slate-400 text-slate-700 text-sm font-medium rounded-xl transition-all duration-300">
                                Invite
                            </button>
                        </div>
                    </div>
                </template>
                
                <!-- Create New Group Card -->
                <div @click="showCreateGroup = true" class="rounded-3xl p-6 backdrop-blur-xl border-2 border-dashed border-slate-300 bg-white/40 hover:border-blue-500 hover:bg-white/60 transition-all duration-300 cursor-pointer group">
                    <div class="flex flex-col items-center justify-center h-full min-h-[300px]">
                        <div class="w-16 h-16 bg-slate-100 group-hover:bg-blue-100 rounded-full flex items-center justify-center mb-4 transition-colors duration-300">
                            <svg class="w-8 h-8 text-slate-400 group-hover:text-blue-600 transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold text-slate-700 group-hover:text-slate-900 transition-colors duration-300">Create New Group</h3>
                        <p class="text-sm text-slate-500 mt-2 text-center">Start splitting bills with friends and family</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Invest View -->
        <section x-show="currentView === 'invest'" class="max-w-7xl mx-auto px-6 lg:px-8 py-12">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">Group Investing</h2>
                <p class="text-xl text-slate-600">Build wealth together through collective investment decisions</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Portfolio Overview -->
                <div class="lg:col-span-2 rounded-3xl p-8 backdrop-blur-xl border border-white/40 bg-white/70">
                    <h3 class="text-xl font-semibold text-slate-900 mb-6">Portfolio Performance</h3>
                    
                        <div class="mb-2 flex items-center gap-2">
                            <button class="px-3 py-1 text-xs rounded-full border border-slate-300 hover:border-blue-500" @click="loadPortfolioHistory('1mo')">1M</button>
                            <button class="px-3 py-1 text-xs rounded-full border border-slate-300 hover:border-blue-500" @click="loadPortfolioHistory('3mo')">3M</button>
                            <button class="px-3 py-1 text-xs rounded-full border border-slate-300 hover:border-blue-500" @click="loadPortfolioHistory('6mo')">6M</button>
                            <button class="px-3 py-1 text-xs rounded-full border border-slate-300 hover:border-blue-500" @click="loadPortfolioHistory('1y')">1Y</button>
                            <button class="px-3 py-1 text-xs rounded-full border border-slate-300 hover:border-blue-500" @click="loadPortfolioHistory('5y')">5Y</button>
                        </div>
                        <div class="mb-6 h-[260px]">
                            <canvas id="portfolioChart"></canvas>
                        </div>
                    
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="text-center p-4 bg-slate-50 rounded-xl">
                            <p class="text-sm text-slate-600 mb-1">Total Value</p>
                            <p class="text-2xl font-bold text-slate-900">$<span x-text="(stats.portfolio_value/1000).toFixed(1)"></span>K</p>
                            <p class="text-sm text-green-600">+12.5%</p>
                        </div>
                        <div class="text-center p-4 bg-slate-50 rounded-xl">
                            <p class="text-sm text-slate-600 mb-1">Monthly Return</p>
                            <p class="text-2xl font-bold text-slate-900">$<span x-text="monthlyReturn.toFixed(0)"></span></p>
                            <p class="text-sm text-green-600">+5.2%</p>
                        </div>
                        <div class="text-center p-4 bg-slate-50 rounded-xl">
                            <p class="text-sm text-slate-600 mb-1">Groups Invested</p>
                            <p class="text-2xl font-bold text-slate-900"><span x-text="investingGroups"></span></p>
                            <p class="text-sm text-slate-500">Active</p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-slate-900 mb-4">Holdings</h4>
                        <div class="space-y-3">
                            <template x-for="holding in holdings" :key="holding.symbol">
                                <div class="flex items-center justify-between p-4 bg-slate-50 rounded-xl">
                                    <div class="flex items-center gap-4">
                                        <div class="w-10 h-10 rounded-lg flex items-center justify-center" :style="'background: ' + holding.color">
                                            <span class="text-white font-bold text-xs" x-text="holding.symbol"></span>
                                        </div>
                                        <div>
                                            <p class="font-medium text-slate-900" x-text="holding.name"></p>
                                            <p class="text-sm text-slate-500"><span x-text="holding.shares"></span> shares</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-semibold text-slate-900">$<span x-text="holding.value.toFixed(2)"></span></p>
                                        <p class="text-sm" :class="holding.change > 0 ? 'text-green-600' : 'text-red-600'">
                                            <span x-text="holding.change > 0 ? '+' : ''"></span><span x-text="holding.change.toFixed(2)"></span>%
                                        </p>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Investment Actions -->
                <div class="space-y-6">
                    <!-- Quick Invest -->
                    <div class="rounded-3xl p-6 backdrop-blur-xl border border-white/40 bg-white/70">
                        <h3 class="text-lg font-semibold text-slate-900 mb-4">Quick Invest</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Select Group</label>
                                <select class="w-full px-4 py-3 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <template x-for="group in userGroups" :key="group.id">
                                        <option :value="group.id" x-text="group.name"></option>
                                    </template>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Amount</label>
                                <div class="relative">
                                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500">$</span>
                                    <input type="number" placeholder="0.00" class="w-full pl-8 pr-4 py-3 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Investment Type</label>
                                <div class="grid grid-cols-2 gap-3">
                                    <button class="p-3 bg-white border-2 border-blue-500 text-blue-600 rounded-xl font-medium">
                                        Conservative
                                    </button>
                                    <button class="p-3 bg-white border border-slate-300 text-slate-700 rounded-xl font-medium hover:border-slate-400">
                                        Aggressive
                                    </button>
                                </div>
                            </div>
                            
                            <button class="w-full py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold rounded-xl transition-all duration-300 shadow-xl shadow-green-500/25">
                                Start Investment Vote
                            </button>
                        </div>
                    </div>

                    <!-- Active Votes -->
                    <div class="rounded-3xl p-6 backdrop-blur-xl border border-white/40 bg-white/70">
                        <h3 class="text-lg font-semibold text-slate-900 mb-4">Active Votes</h3>
                        
                        <div class="space-y-3">
                            <div class="p-4 bg-amber-50 border border-amber-200 rounded-xl">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="font-medium text-slate-900">Buy TSLA</span>
                                    <span class="text-sm text-amber-600">Ends in 2h</span>
                                </div>
                                <div class="mb-3">
                                    <div class="flex justify-between text-sm text-slate-600 mb-1">
                                        <span>3 of 4 voted</span>
                                        <span>75%</span>
                                    </div>
                                    <div class="w-full bg-amber-200 rounded-full h-2">
                                        <div class="bg-amber-500 h-2 rounded-full" style="width: 75%"></div>
                                    </div>
                                </div>
                                <button class="w-full py-2 bg-amber-600 hover:bg-amber-700 text-white text-sm font-medium rounded-xl transition-all duration-300">
                                    Cast Your Vote
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- AI Insights -->
                    <div class="rounded-3xl p-6 backdrop-blur-xl border border-white/40 bg-white/70">
                        <h3 class="text-lg font-semibold text-slate-900 mb-4">AI Insights</h3>
                        
                        <div class="space-y-3">
                            <div class="p-3 bg-blue-50 border border-blue-200 rounded-xl">
                                <p class="text-sm text-slate-700 mb-2">Based on your group's risk profile and goals:</p>
                                <p class="text-sm font-medium text-blue-900">"Consider diversifying into international markets. Your portfolio is 85% US-focused."</p>
                            </div>
                            
                            <button class="w-full py-2 border border-slate-300 hover:border-slate-400 text-slate-700 text-sm font-medium rounded-xl transition-all duration-300">
                                Get Personalized Advice
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard View -->
        <section x-show="currentView === 'dashboard'" class="max-w-7xl mx-auto px-6 lg:px-8 py-12">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">Dashboard</h2>
                <p class="text-xl text-slate-600">Your financial overview and insights</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="rounded-2xl p-6 bg-white border border-slate-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <span class="text-sm text-green-600 font-medium">+12.5%</span>
                    </div>
                    <p class="text-sm text-slate-600 mb-1">Total Saved</p>
                    <p class="text-2xl font-bold text-slate-900">$<span x-text="(stats.total_saved/1000).toFixed(1)"></span>K</p>
                </div>
                
                <div class="rounded-2xl p-6 bg-white border border-slate-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                            </svg>
                        </div>
                        <span class="text-sm text-green-600 font-medium">+5.2%</span>
                    </div>
                    <p class="text-sm text-slate-600 mb-1">Investment Returns</p>
                    <p class="text-2xl font-bold text-slate-900">$<span x-text="stats.investment_returns.toFixed(0)"></span></p>
                </div>
                
                <div class="rounded-2xl p-6 bg-white border border-slate-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                            </svg>
                        </div>
                        <span class="text-sm text-slate-500 font-medium">Active</span>
                    </div>
                    <p class="text-sm text-slate-600 mb-1">Groups</p>
                    <p class="text-2xl font-bold text-slate-900"><span x-text="stats.groups_count || userGroups.length"></span></p>
                </div>
                
                <div class="rounded-2xl p-6 bg-white border border-slate-200">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-indigo-100 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                            </svg>
                        </div>
                        <span class="text-sm text-slate-500 font-medium">This month</span>
                    </div>
                    <p class="text-sm text-slate-600 mb-1">Bills Split</p>
                    <p class="text-2xl font-bold text-slate-900"><span x-text="stats.monthly_bills"></span></p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 overflow-x-hidden">
                <!-- Recent Transactions -->
                <div class="rounded-3xl p-8 backdrop-blur-xl border border-white/40 bg-white/70 max-h-[600px] overflow-y-auto">
                    <h3 class="text-xl font-semibold text-slate-900 mb-6">Recent Transactions</h3>
                    
                    <div class="space-y-3">
                        <template x-for="transaction in recentTransactions" :key="transaction.id">
                            <div class="flex items-center justify-between p-4 hover:bg-slate-50 rounded-xl transition-colors duration-300">
                                <div class="flex items-center gap-4">
                                    <div class="w-10 h-10 rounded-xl flex items-center justify-center" :class="transaction.type === 'split' ? 'bg-blue-100' : 'bg-green-100'">
                                        <svg class="w-5 h-5" :class="transaction.type === 'split' ? 'text-blue-600' : 'text-green-600'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="font-medium text-slate-900" x-text="transaction.description"></p>
                                        <p class="text-sm text-slate-500" x-text="transaction.group"></p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="font-semibold" :class="transaction.amount > 0 ? 'text-green-600' : 'text-slate-900'">
                                        <span x-text="transaction.amount > 0 ? '+' : ''"></span>$<span x-text="Math.abs(transaction.amount).toFixed(2)"></span>
                                    </p>
                                    <p class="text-xs text-slate-500" x-text="transaction.date"></p>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Spending Insights -->
                <div class="rounded-3xl p-8 backdrop-blur-xl border border-white/40 bg-white/70">
                    <h3 class="text-xl font-semibold text-slate-900 mb-6">Spending Insights</h3>
                    
                    <canvas id="spendingChart" width="400" height="300"></canvas>
                    
                    <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-xl">
                        <p class="text-sm font-medium text-blue-900 mb-2">AI Tip</p>
                        <p class="text-sm text-blue-800">You've saved 23% more this month by splitting bills! Consider investing the extra $<span x-text="(stats.total_saved * 0.23 / 12).toFixed(0)"></span> in your group portfolio.</p>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modals -->
    <!-- Login Modal -->
    <div x-show="showLogin" x-cloak class="fixed inset-0 z-50 flex items-center justify-center p-4" @click.away="showLogin = false">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <div class="relative bg-white rounded-3xl p-8 max-w-md w-full" @click.stop>
            <button @click="showLogin = false" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            
            <h2 class="text-2xl font-bold text-slate-900 mb-6">Welcome Back</h2>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Email</label>
                    <input type="email" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Password</label>
                    <input type="password" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                                <button @click="login()" class="w-full py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold rounded-xl transition-all duration-300">
                    Sign In
                </button>
                
                <p class="text-center text-sm text-slate-600">
                    Don't have an account? 
                    <button @click="showLogin = false; showSignup = true" class="text-blue-600 hover:text-blue-700 font-medium">Sign up</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div x-show="showSignup" x-cloak class="fixed inset-0 z-50 flex items-center justify-center p-4" @click.away="showSignup = false">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        <div class="relative bg-white rounded-3xl p-8 max-w-md w-full" @click.stop>
            <button @click="showSignup = false" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            
            <h2 class="text-2xl font-bold text-slate-900 mb-6">Create Account</h2>
            
                <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Full Name</label>
                        <input type="text" placeholder="Full Name" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Email</label>
                        <input type="email" placeholder="Email" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Password</label>
                        <input type="password" placeholder="Password" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <button @click="signup()" class="w-full py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold rounded-xl transition-all duration-300">
                    Create Account
                </button>
                
                <p class="text-center text-sm text-slate-600">
                    Already have an account? 
                    <button @click="showSignup = false; showLogin = true" class="text-blue-600 hover:text-blue-700 font-medium">Sign in</button>
                </p>
            </div>
        </div>
    </div>

    <script>
        function communityCapitalApp() {
            return {
                // View state
                currentView: 'home',
                user: null,
                mobileMenu: false,
                showLogin: false,
                showSignup: false,
                showDemo: false,
                showAIDemo: false,
                showCreateGroup: false,
                
                // Data
                stats: { total_saved: 0, investment_returns: 0, monthly_bills: 0, portfolio_value: 0, groups_count: 0 },
                monthlyReturn: 542,
                investingGroups: 3,
                dashboardLoaded: false,
                plaidStatus: '',
                
                // Split functionality
                scanningReceipt: false,
                scannedItems: [],
                manualItems: [],
                newItem: { name: '', price: '' },
                selectedGroup: '',
                newGroupName: '',
                newGroupMembers: [],
                newMemberEmail: '',
                itemAssignments: {},
                taxRate: 0.085,
                tipRate: 0.18,
                taxRatePct: 8.5,
                tipRatePct: 18,
                receiptFile: null,
                
                // User groups
                userGroups: [
                    {
                        id: 1,
                        name: 'Dinner Squad',
                        color: 'linear-gradient(135deg, #f97316, #fb923c)',
                        members: [
                            { id: 1, name: 'You' },
                            { id: 2, name: 'Alex' },
                            { id: 3, name: 'Sam' },
                            { id: 4, name: 'Jordan' }
                        ],
                        totalSplit: 1275.50,
                        yourShare: 318.88,
                        invested: 427.50,
                        recentActivities: [
                            { id: 1, merchant: 'Olive Garden', amount: 84.60 },
                            { id: 2, merchant: 'Starbucks', amount: 32.45 }
                        ]
                    },
                    {
                        id: 2,
                        name: 'Roommates',
                        color: 'linear-gradient(135deg, #3b82f6, #60a5fa)',
                        members: [
                            { id: 1, name: 'You' },
                            { id: 5, name: 'Chris' },
                            { id: 6, name: 'Morgan' }
                        ],
                        totalSplit: 892.30,
                        yourShare: 297.43,
                        invested: 1250.00,
                        recentActivities: [
                            { id: 3, merchant: 'Whole Foods', amount: 156.78 },
                            { id: 4, merchant: 'Target', amount: 89.99 }
                        ]
                    }
                ],
                
                // Live activities
                liveActivities: [
                    { id: 1, merchant: 'Chipotle', group: 'NYC Friends', members: 5, amount: 67.45, time: '2 min ago', color: 'bg-orange-500' },
                    { id: 2, merchant: 'Uber', group: 'Weekend Trip', members: 3, amount: 34.20, time: '5 min ago', color: 'bg-blue-500' },
                    { id: 3, merchant: 'AMC Theaters', group: 'Movie Night', members: 4, amount: 89.60, time: '12 min ago', color: 'bg-purple-500' }
                ],
                
                // Portfolio holdings
                holdings: [],
                
                // Recent transactions
                recentTransactions: [],
                auth: { token: localStorage.getItem('cc_token') || '' },
                
                // Methods
                init() {
                    this.startLiveActivitySimulation();
                    if (this.auth.token) {
                        this.fetchDashboard();
                        this.fetchGroups();
                        this.fetchHoldings();
                    }
                    this.initCharts();
                },
                apiHeaders() {
                    return this.auth.token ? { 'Authorization': `Bearer ${this.auth.token}`, 'Content-Type': 'application/json' } : { 'Content-Type': 'application/json' };
                },
                async initPlaid() {
                    try {
                        if (!this.auth.token) { this.showLogin = true; return; }
                        const res = await fetch('/api/plaid/create-link-token', { method: 'POST', headers: this.apiHeaders() });
                        const data = await res.json();
                        if (data && data.link_token) {
                            const handler = Plaid.create({
                                token: data.link_token,
                                onSuccess: async (public_token) => {
                                    this.plaidStatus = 'Exchanging token...';
                                    const ex = await fetch('/api/plaid/exchange-token', { method: 'POST', headers: this.apiHeaders(), body: JSON.stringify({ public_token }) });
                                    const exData = await ex.json();
                                    this.plaidStatus = ex.ok ? 'Bank connected' : (exData.error || 'Failed to connect bank');
                                }
                            });
                            handler.open();
                        }
                    } catch (e) { this.plaidStatus = 'Failed to initialize Plaid'; }
                },
                async fetchDashboard() {
                    try {
                        const res = await fetch('/api/analytics/dashboard', { headers: this.apiHeaders() });
                        const data = await res.json();
                        if (data && data.stats) {
                            this.stats = data.stats;
                            this.recentTransactions = (data.recent_transactions || []).map(t => ({
                                id: t.id,
                                type: t.type.includes('investment') ? 'invest' : 'split',
                                description: t.description || t.type,
                                group: '',
                                amount: Number(t.amount),
                                date: new Date(t.created_at).toLocaleDateString()
                            }));
                            this.dashboardLoaded = true;
                        }
                    } catch (_) {}
                },
                async fetchGroups() {
                    try {
                        const res = await fetch('/api/groups', { headers: this.apiHeaders() });
                        const groups = await res.json();
                        // Enrich with members list
                        for (const g of groups) {
                            try {
                                const mRes = await fetch(`/api/groups/${g.id}/members`, { headers: this.apiHeaders() });
                                const members = await mRes.json();
                                g.members = (members || []).map(m => ({ id: m.id, name: m.name || m.email }));
                            } catch (_) { g.members = []; }
                        }
                        this.userGroups = groups;
                    } catch (_) {}
                },
                async fetchHoldings() {
                    try {
                        // Build holdings view from investments table via dashboard endpoint if needed later
                        this.portfolioValue = this.stats.portfolio_value || 0;
                    } catch (_) {}
                },
                
                initCharts() {
                    // Portfolio Chart
                    setTimeout(() => {
                        if (document.getElementById('portfolioChart')) {
                            const ctx = document.getElementById('portfolioChart').getContext('2d');
                            this.portfolioChart = new Chart(ctx, {
                                type: 'line',
                                data: { labels: [], datasets: [{ label: 'Portfolio Value', data: [], borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', tension: 0.4, fill: true }] },
                                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: false, ticks: { callback: v => '$' + (v/1000) + 'K' } } } }
                            });
                            // Load initial 6M history
                            this.loadPortfolioHistory('6mo');
                        }
                        
                        // Spending Chart
                        if (document.getElementById('spendingChart')) {
                            const ctx2 = document.getElementById('spendingChart').getContext('2d');
                            new Chart(ctx2, {
                                type: 'doughnut',
                                data: {
                                    labels: ['Food & Dining', 'Transportation', 'Entertainment', 'Shopping', 'Other'],
                                    datasets: [{
                                        data: [35, 20, 15, 20, 10],
                                        backgroundColor: [
                                            '#3b82f6',
                                            '#10b981',
                                            '#8b5cf6',
                                            '#f59e0b',
                                            '#6b7280'
                                        ]
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: false,
                                    plugins: {
                                        legend: {
                                            position: 'bottom'
                                        }
                                    }
                                }
                            });
                        }
                    }, 100);
                },
                async loadPortfolioHistory(period) {
                    try {
                        const res = await fetch(`/ai/api/market/history?symbols=SPY,VTI,QQQ&period=${encodeURIComponent(period)}&interval=1wk`);
                        const data = await res.json();
                        const spy = data.SPY || { timestamps: [], close: [] };
                        const labels = spy.timestamps.map(ts => new Date(ts * 1000).toLocaleDateString());
                        const values = spy.close;
                        this.portfolioChart.data.labels = labels;
                        this.portfolioChart.data.datasets[0].data = values;
                        this.portfolioChart.update();
                    } catch (_) {}
                },
                
                startLiveActivitySimulation() {
                    setInterval(() => {
                        const merchants = ['Starbucks', 'Chipotle', 'Target', 'Uber', 'Amazon', 'Netflix'];
                        const groups = ['College Friends', 'Family', 'Roommates', 'Work Team', 'Book Club'];
                        const colors = ['bg-blue-500', 'bg-green-500', 'bg-purple-500', 'bg-orange-500', 'bg-pink-500'];
                        
                        const newActivity = {
                            id: Date.now(),
                            merchant: merchants[Math.floor(Math.random() * merchants.length)],
                            group: groups[Math.floor(Math.random() * groups.length)],
                            members: Math.floor(Math.random() * 6) + 2,
                            amount: Math.random() * 150 + 10,
                            time: 'just now',
                            color: colors[Math.floor(Math.random() * colors.length)]
                        };
                        
                        this.liveActivities.unshift(newActivity);
                        this.liveActivities = this.liveActivities.slice(0, 5);
                        
                        // Update stats
                        this.totalSplit += newActivity.amount;
                        this.activeGroups = Math.min(99, this.activeGroups + (Math.random() > 0.7 ? 1 : 0));
                    }, 5000);
                },
                
                handleReceiptUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.receiptFile = file;
                        this.scanningReceipt = true;
                        const imgForm = new FormData(); imgForm.append('image', file);
                        fetch('/ai/api/ocr/receipt', { method: 'POST', body: imgForm })
                          .then(r => r.json()).then(r => {
                              if (r && Array.isArray(r.items)) {
                                  this.scannedItems = r.items.map(i => ({ name: i.name, price: Number(i.price) }));
                              }
                          }).catch(()=>{})
                          .finally(()=>{ this.scanningReceipt = false; });
                    }
                },
                
                addItem() {
                    if (this.newItem.name && this.newItem.price) {
                        this.manualItems.push({
                            name: this.newItem.name,
                            price: parseFloat(this.newItem.price)
                        });
                        this.newItem = { name: '', price: '' };
                    }
                },
                
                addMember() {
                    if (this.newMemberEmail && !this.newGroupMembers.includes(this.newMemberEmail)) {
                        this.newGroupMembers.push(this.newMemberEmail);
                        this.newMemberEmail = '';
                    }
                },
                
                getGroupMembers(groupId) {
                    const group = this.userGroups.find(g => String(g.id) === String(groupId));
                    return group && Array.isArray(group.members) ? group.members : [];
                },
                
                toggleItemAssignment(itemIndex, memberId) {
                    if (!this.itemAssignments[itemIndex]) {
                        this.itemAssignments[itemIndex] = [];
                    }
                    
                    const idx = this.itemAssignments[itemIndex].indexOf(memberId);
                    if (idx > -1) {
                        this.itemAssignments[itemIndex].splice(idx, 1);
                    } else {
                        this.itemAssignments[itemIndex].push(memberId);
                    }
                },
                
                isAssigned(itemIndex, memberId) {
                    return this.itemAssignments[itemIndex] && this.itemAssignments[itemIndex].includes(memberId);
                },
                
                calculateSubtotal() {
                    const allItems = [...this.scannedItems, ...this.manualItems];
                    return allItems.reduce((sum, item) => sum + item.price, 0);
                },
                
                calculateTotal() {
                    const subtotal = this.calculateSubtotal();
                    const tax = subtotal * (this.taxRate || 0.085);
                    const tip = subtotal * (this.tipRate || 0.18);
                    return subtotal + tax + tip;
                },
                
                async processSplit() {
                    try {
                        if (!this.auth.token) { this.showLogin = true; return; }
                        const items = [...this.scannedItems, ...this.manualItems].map((it, idx) => ({ id: idx + 1, name: it.name, price: Number(it.price) }));
                        const participants = this.getGroupMembers(this.selectedGroup).map(m => {
                            const itemIds = Object.entries(this.itemAssignments)
                              .filter(([idx, arr]) => (arr || []).includes(m.id))
                              .map(([idx]) => Number(idx) + 1);
                            return { user_id: m.id, items: itemIds };
                        });
                        const form = new FormData();
                        form.append('group_id', this.selectedGroup);
                        form.append('merchant_name', 'Custom Merchant');
                        form.append('items', JSON.stringify(items));
                        const subtotal = this.calculateSubtotal();
                        form.append('tax_amount', (subtotal * (this.taxRate || 0.085)).toFixed(2));
                        form.append('tip_amount', (subtotal * (this.tipRate || 0.18)).toFixed(2));
                        form.append('participants', JSON.stringify(participants));
                        if (this.receiptFile) { form.append('receipt', this.receiptFile); }
                        const res = await fetch('/api/bills/create', { method: 'POST', headers: { 'Authorization': `Bearer ${this.auth.token}` }, body: form });
                        const data = await res.json();
                        if (res.ok) {
                            alert('Bill created and split started.');
                            this.scannedItems = []; this.manualItems = []; this.itemAssignments = {}; this.selectedGroup = ''; this.receiptFile = null;
                        } else { alert(data.error || 'Failed to create bill'); }
                    } catch (e) { alert('Failed to create bill'); }
                },
                
                viewGroupDetails(groupId) {
                    console.log('View group details:', groupId);
                },
                
                inviteToGroup(groupId) {
                    const email = prompt('Enter email address to invite:');
                    if (email) {
                        alert(`Invitation sent to ${email}`);
                    }
                },
                
                async login() {
                    const email = document.querySelector('[type="email"]').value;
                    const password = document.querySelector('[type="password"]').value;
                    try {
                        const res = await fetch('/api/auth/login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, password }) });
                        const data = await res.json();
                        if (data && data.token) {
                            this.auth.token = data.token; localStorage.setItem('cc_token', data.token);
                            this.user = data.user; this.showLogin = false; this.fetchDashboard(); this.fetchGroups();
                        }
                    } catch (_) {}
                },
                
                async signup() {
                    const name = document.querySelector('input[placeholder="Full Name"]').value;
                    const email = document.querySelector('input[placeholder="Email"]').value;
                    const password = document.querySelectorAll('input[type="password"]')[0].value;
                    try {
                        const res = await fetch('/api/auth/register', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, email, password }) });
                        const data = await res.json();
                        if (data && data.token) {
                            this.auth.token = data.token; localStorage.setItem('cc_token', data.token);
                            this.user = data.user; this.showSignup = false; this.fetchDashboard(); this.fetchGroups();
                        }
                    } catch (_) {}
                },
                
                logout() {
                    this.user = null; this.auth.token = ''; localStorage.removeItem('cc_token'); this.currentView = 'home';
                }
            }
        }
    </script>
</body>
</html>